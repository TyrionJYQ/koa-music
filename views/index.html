<!-- 继承父模板 -->
{{extend './layout/main.html'}}
<!-- 填坑 -->

{{block 'container'}}

<style type="text/css">
  #box {
    background-color: rgba(0, 0, 0, 0.2);
    width: 300px;
    height: 360px;
    margin-top: 10px;
    overflow: hidden;
    padding: 0;
  }

  #box p {
    padding: 0 15px;
  }

  #lrc {
    margin-top: 130px;
    position: absolute;
    text-align: center;
    padding-top: 60px;
  }

  .gl {
    color: hotpink;
    background-color: red;
  }
</style>

<div class="container">
  <div class="page-header">
    <h1>首页--
      <small>我的音乐</small>
    </h1>
  </div>
  <a href="/music/addMusic" class="btn btn-success">添加音乐</a>
</div>
<div class="container">
  <div class="row" style="display: flex;">
    <div style="flex: 3; margin-right: 10px;">
      <table class="table table-striped table-hover">
        <thead>
          <th>歌曲标题</th>
          <th>时长</th>
          <th>歌手</th>
          <th>编辑</th>
          <th>删除</th>
          <th>播放</th>
        </thead>
        <tbody class="list_container" id="list_container">
          {{ each musics }}
          <tr>

            <td>{{ $value.title}}</td>
            <td>{{ $value.time }}</td>
            <td>{{ $value.singer}}</td>
            <td>
              <!-- 通过href发送get请求 -->
              <a href="/music/editMusic?id={{$value.id}}" class="edit">编辑</a>
            </td>
            <td>
              <a class="del" href="javascript:void(0)"  request-href="/music/deleteMusic?id={{$value.id}}">删除</a>
            </td>
            <td>
              <span style="cursor:pointer" src="" class="glyphicon glyphicon-play-circle ply"></span>
            </td>
          </tr>
          {{ /each }}


        </tbody>
      </table>
    </div>
    <div style="flex: 2">
      <p>正在播放音乐:</p>
      <audio id="audio" autoplay src="" controls="controls">
      </audio>
      <div id="box" class="col-md-3">
        <div id="lrc">
        </div>
      </div>
    </div>
  </div>
</div>


<script>
(function() {
  let musics = document.querySelectorAll('a.del');
  console.log(musics)
  musics.forEach(music => {
    // 绑定删除事件
    music.addEventListener('click', function(e) {
      let url = $(this).attr('request-href');
      // 发送delete请求
      Http.deleteReq(url, data => {
        if(data.code === '002') return Swal.fire({
          'type': 'error',
          'title': '删除失败',
          'text': data.msg
        });
        Swal.fire({
          type: 'success',
          text: '删除成功!',
          title: '',
          showConfirmButton: false
        });
        let tr = e.target.parentNode.parentNode;
        tr.parentNode.removeChild(tr);
      }, err => {
        Swal.fire({
          type: 'error',
          text: data.msg,
          title: '删除失败'
        })
      })
    });
  })




})();

</script> {{/block}}